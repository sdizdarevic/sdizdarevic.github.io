<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Numato VCNL4000 - Integrated Proximity and Ambient Light Sensor
 | sdizdarevic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Numato has great prducts, and VCNL4000 Integrated Proximity and Ambient Light Sensor board is one of them.  The VCNL4000 is a proximity sensor with an integrated ambient light sensor. It is the indust">
<meta property="og:type" content="article">
<meta property="og:title" content="Numato VCNL4000 - Integrated Proximity and Ambient Light Sensor
">
<meta property="og:url" content="http://sdizdarevic.github.io/2018/03/07/Numato-VCNL4000-Integrated-Proximity-and-Ambient-Light-Sensor/index.html">
<meta property="og:site_name" content="sdizdarevic">
<meta property="og:description" content="Numato has great prducts, and VCNL4000 Integrated Proximity and Ambient Light Sensor board is one of them.  The VCNL4000 is a proximity sensor with an integrated ambient light sensor. It is the indust">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://78.media.tumblr.com/bf8cc9ca023739a7c4b57b759d8c3902/tumblr_inline_n3rsfmwkL91rzudnu.jpg">
<meta property="article:published_time" content="2018-03-07T13:40:00.000Z">
<meta property="article:modified_time" content="2023-04-25T18:18:11.431Z">
<meta property="article:author" content="sdizdar">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://78.media.tumblr.com/bf8cc9ca023739a7c4b57b759d8c3902/tumblr_inline_n3rsfmwkL91rzudnu.jpg">
  
    <link rel="alternate" href="/atom.xml" title="sdizdarevic" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">sdizdarevic</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://sdizdarevic.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Numato-VCNL4000-Integrated-Proximity-and-Ambient-Light-Sensor" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/03/07/Numato-VCNL4000-Integrated-Proximity-and-Ambient-Light-Sensor/" class="article-date">
  <time class="dt-published" datetime="2018-03-07T13:40:00.000Z" itemprop="datePublished">2018-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Numato VCNL4000 - Integrated Proximity and Ambient Light Sensor

    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://numato.cc&t=MTc2ZTA2ZWNiZjg3YmEyNjJkOTk4YTIzZWExOWQwNzhiYmM0Y2RkOSxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">Numato</a> has great prducts, and VCNL4000 Integrated Proximity and Ambient Light Sensor board is one of them.</p>
<p><img src="http://78.media.tumblr.com/bf8cc9ca023739a7c4b57b759d8c3902/tumblr_inline_n3rsfmwkL91rzudnu.jpg" alt="image"></p>
<p>The VCNL4000 is a proximity sensor with an integrated ambient light sensor. It is the industry’s first optical sensor to combine an infrared emitter, PIN photodiode, ambient light sensor and signal processing in a single package with a 16-bit ADC for proximity measurement as well as ambient light measurement.</p>
<p>VCNL4000 is designed specifically for the low height requirements of smart phone, mobile phone, digital camera, and tablet PC applications.Through its standard I2C bus serial digital interface, it allows easy access to a “Proximity Signal” and “Light intensity” measurement without complex calculations or programming (also, this sensor has inside it IIR filter). First, I am going to tell about I2C protocol that this sensor uses to communicate with MCU.</p>
<p>This sensor is easy to use with any microcontroller that has i2c capability. It is 5 volt compliant so you can use it with 3.3V or 5V logic with no risk of damage. There is an onboard 3.3V ultra low dropout regulator so you can power it with 3.3 to 5.0V. However, if you can give it 5.0V that is ideal since the VIN voltage powers the IR LED and the higher the voltage you can give it, the more powerful it is. Also, this sensor is „Digitally Addressable Sensor“ with IIR filter inside which does all the „magic“ for you, so you do not need measure characteristic and linearise it in its working area like for analog sensors do. That means VCNL4000 does not have a analog output, but instead outputs a 16bit digital reading that will be „shown“ on MCU.</p>
<p>An Inter-IC bus is often used to communicate across circuit-board distances. Here’s a primer on the protocol.</p>
<p>Philips originally developed I2C for communication between devices inside of a TV set. Examples of simple I2C-compatible devices found in embedded systems include EEPROMs, thermal sensors, and real-time clocks. I2C is also used as a control interface to signal processing devices that have separate, application-specific data interfaces. For instance, it’s commonly used in multimedia applications, where typical devices include RF tuners, video decoders and encoders, and audio processors. In all, Philips, National Semiconductor, Xicor, Siemens, and other manufacturers offer hundreds of I2C-compatible devices. With I2C you can chain „only“ upto 128 devices&#x2F;sensors. Using I2C you can set individual address locations for various sensors..</p>
<p>I2C uses just two wires to implement serial communication between one or more master devices and one or more slave devices. Communication is initiated with a START bit (Which is a START condition generated by bringing SDA low while CLK is high) and then is followed with a Control Byte. The control byte consists of the control code, device address, and the read&#x2F;write bit.</p>
<p>SCL is the clock line. It is used to synchronize all data transfers over the I2C bus. SDA is the data line. The SCL &amp; SDA lines are connected to all devices on the I2C bus. There needs to be a third wire which is just the ground or 0 volts. There may also be a 5volt wire is power is being distributed to the devices. Both SCL and SDA lines are “open drain” drivers. What this means is that the chip can drive its output low, but it cannot drive it high. For the line to be able to go high you must provide pull-up resistors to the 5v supply.</p>
<p>There are both 7- and 8-bit versions of I2C addresses. 7 bits identify the device, and the eighth bit determines if it’s being written to or read from. The Wire library uses 7 bit addresses throughout. If you have a datasheet or sample code that uses 8 bit address, you’ll want to drop the low bit (i.e. shift the value one bit to the right), yielding an address between 0 and 127.</p>
<p>**The I2C Software Protocol<br>**The first thing that will happen is that the master will send out a start sequence. This will alert all the slave devices on the bus that a transaction is starting and they should listen in incase it is for them. Next the master will send out the device address. The slave that matches this address will continue with the transaction, any others will ignore the rest of this transaction and wait for the next. Having addressed the slave device the master must now send out the internal location or register number inside the slave that it wishes to write to or read from. This number is obviously dependant on what the slave actually is and how many internal registers it has. Some very simple devices do not have any, but most do, including all of our modules. Our CMPS03 has 16 locations numbered 0-15. The SRF08 has 36. Having sent the I2C address and the internal register address the master can now send the data byte (or bytes, it doesn’t have to be just one). The master can continue to send data bytes to the slave and these will normally be placed in the following registers because the slave will automatically increment the internal register address after each byte. When the master has finished writing all data to the slave, it sends a stop sequence which completes the transaction. So to write to a slave device:<br>1. Send a start sequence<br>2. Send the I2C address of the slave with the R&#x2F;W bit low (even address)<br>3. Send the internal register number you want to write to<br>4. Send the data byte<br>5. [Optionally, send any further data bytes]<br>6. Send the stop sequence.</p>
<p><strong>Reading from the Slave</strong><br>This is a bit more complicated - but not too much. Before reading data from the slave device, you must tell it which of its internal addresses you want to read. So a read of the slave actually starts off by writing to it. This is the same as when you want to write to it: You send the start sequence, the I2C address of the slave with the R&#x2F;W bit low (even address) and the internal register number you want to write to. Now you send another start sequence (sometimes called a restart) and the I2C address again - this time with the read bit set. You then read as many data bytes as you wish and terminate the transaction with a stop sequence.</p>
<p>Now I am going to implement this on arduino, because of its API simplicity.Arduino uses  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/reference/wire&t=MzIxNTQ0NTQ1YTI3Zjc4MjBjMmZiMjJmNjIzYTg2ZjE0YTg5Y2RkNSxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">wire.h</a>library,and this library allows you to communicate with I2C &#x2F; TWI devices. Arduino Uno uses A4 (SDA), and A5 (SCL) pins for I2C.</p>
<p>First, you should rad VCNL4000 data sheet to see registers which this sensor uses. It is available  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://dlnmh9ip6v2uc.cloudfront.net/datasheets/BreakoutBoards/vcnl4000App.pdf&t=MGZlMTg3Y2E0NmJmNGUxYzk2MDhkZDJhMjJlNzM1ZmQ3ZGNiZDZhOSxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">here</a>. In page 6 there is a simple, understandable flowchart for proximity sensing and this is a start-off for our algorithm implementation.</p>
<p><strong>Wiring the sensor</strong></p>
<p>I already said that VCNL4000 is an I2C device. I2C is a 2-wire serial connection, so you just need to connect the SDA (Data) and SCL (Clock) lines to your Arduino for communication. On most arduinos SDA is on analog pin A4, and SCL is on analog pin A5. On an arduino mega, SDA is digital 20, and SCL is digital 21. The Leonardo’s have their own special connections.</p>
<p>The board needs 3.3v to run, but it also needs 5V for the IR led that it uses to check the proximity.</p>
<p>So to wire this sensor with arduino, connect (the right side is Arduino connectors, left is sensor):</p>
<p>IRA - &gt; 5V</p>
<p>VDD -&gt; 3.3V</p>
<p>GND -&gt; GND</p>
<p>SDA -&gt; A4</p>
<p>SCL -&gt; A5</p>
<p><strong>REGISTER FUNCTIONS</strong></p>
<p>The VCNL4000 has a fix slave address for the host programming and accessing selection. The predefined 7 bit I2C bus address is set to 0010 011 &#x3D; 13h. The least significant bit (LSB) defines read or write mode. Accordingly the bus address is set to 0010 011x &#x3D; 26h for write, 27h for read.</p>
<p>VCNL4000 has twelve user accessible 8 bit registers. The register addresses are 80h (register #0) to 8Bh (register #11).</p>
<p>The VCNL4000 contains twelve 8-bit registers for operation control, parameter setup and result buffering. All registers are accessible via I2C communication. Some of the registers like register #2 and register #11 are not intended to use by customer, and we are not going to use all of the registers.</p>
<p>So, lets go coding!</p>
<p>Before you start, you need to know about bit manipulation in C, so read first  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://en.wikipedia.org/wiki/Bit_manipulation&t=ZmU0YmNlZWE4NWE3YzkyYzA3MWE2ZGViMGEyYmQ3MjFhMDczNDQ4YixwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">http://en.wikipedia.org/wiki/Bit_manipulation</a> , its easy, belive me!</p>
<p>First, we need to include arduino wire library where all functions for I2C communication are (<a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireBegin&t=ZmFhNTdiYjRkNTBhMmVlZTk4MDhhMDI2NDI1N2RkMmJlN2Y4YzAwNyxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">begin</a>(),  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireRequestFrom&t=Y2U4ZWNmZjMxODcxZDJiNDA3Y2FjOWE0MWM2YjdhYjZmNWZmYjE3YyxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">requestFrom</a>(),  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireBeginTransmission&t=YzIyYTBiODY5ZmM2MDY4ZGZiN2Y5OWEwZTk1MzU1MTY5OGE5YTE1MixwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">beginTransmission</a>(),  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireEndTransmission&t=NjkyZjA4ZGY4ZGRhYWE2YjkxOWM1MWNkN2EyNjczZmYxYmM0YWI0MixwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">endTransmission</a>(),  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireWrite&t=MDk0ODY3NGM1ODc5Y2M1ZDZlMmUyNmVjOGNlYTRiMzk5ZmM5YzgzYyxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">write</a>(),  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireAvailable&t=MmMyMjM0Nzc3YmUwNjQ0ZWRkYmNlNjRhNmZiODU0YzA3MzQ5ZDYyOSxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">available</a>(),  <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireRead&t=Mjg0YWI4OGFkYjMzOWUxOGRjNDI2Y2U0ODNmZWM5OTU5MTA2YTIzMixwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">read</a>(),<a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireOnReceive&t=MDg5NTdkM2VkZWNjN2RiYTQ2MTA3MzI0MTZmOGQ2N2Q1MjllYmNjYSxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">onReceive</a>(),<a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://arduino.cc/en/Reference/WireOnRequest&t=ZGEzMWFlN2YwNWI0N2Y2MmE0M2Q1MjY5MTM5ZTJlOGZhMTJiYTc2YSxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">onRequest</a>())</p>
<p>We include library this way: #include &lt;Wire.h&gt;</p>
<p>Next,  we need to initialise  the I2C Address of the board,</p>
<p>#define VCNL4000_ADDRESS 0x13 &#x2F;&#x2F; I2C bus address is set to<br>&#x2F;&#x2F;0010 011 &#x3D;13h&#x2F;&#x2F; –&gt; see the datasheet page 9</p>
<p>&#x2F;&#x2F;Now wee need setup function -&gt; this function loads only once:</p>
<p>void setup(){</p>
<p>  Serial.begin(9600);  &#x2F;&#x2F; Serial used to print data</p>
<p>  Wire.begin();  &#x2F;&#x2F; initialize I2C – see arduino reference for wire lib</p>
<p>  initVCNL4000(); &#x2F;&#x2F;initialize and setup the board -&gt; function</p>
<p>}</p>
<p>&#x2F;&#x2F;our loop function    </p>
<p>void loop(){            </p>
<p>  unsigned int ambientValue &#x3D; readAmbient(); &#x2F;&#x2F;reading ambient light<br> &#x2F;&#x2F;data -&gt; it takes about 100ms to read this data</p>
<p>  unsigned int proximityValue &#x3D; readProximity();</p>
<p>  Serial.print(ambientValue);</p>
<p>  Serial.print(“ | “);</p>
<p>  Serial.println(proximityValue);</p>
<p>  delay(100);  &#x2F;&#x2F;Slow down the printing</p>
<p>  &#x2F;&#x2F;  the readings take about 100ms to execute</p>
<p>}</p>
<p>Out initVCNL4000() function looks like this:</p>
<p>void initVCNL4000(){</p>
<p>byte temp &#x3D; readVCNLByte(0x81); &#x2F;&#x2F; Register #1 Product ID Revision &#x2F;&#x2F;Register - &gt;Register address &#x3D; 81h. This register contains information &#x2F;&#x2F;about product ID and product revision.</p>
<p>&#x2F;&#x2F;Register data value of current revision &#x3D; 11h -&gt; check datasheet.</p>
<p>if (temp !&#x3D; 0x11){ &#x2F;&#x2F; Product ID Should be 0x11</p>
<p>Serial.print(“initVCNL4000 failed to initialize”);</p>
<p>Serial.println(temp, HEX);</p>
<p>}else{</p>
<p>Serial.println(“VNCL4000 Connected…”);</p>
<p>}</p>
<p>&#x2F;*VNCL400 init params</p>
<p>Feel free to play with any of these values, but check the datasheet first!*&#x2F;</p>
<p>&#x2F;&#x2F; Register #4 Ambient Light Parameter Register</p>
<p>&#x2F;&#x2F;Register address &#x3D; 84h.</p>
<p>writeVCNLByte(0x84, 0x0F); &#x2F;&#x2F; Configures ambient light measures - &#x2F;&#x2F;Single conversion mode, 128 averages (2^7&#x3D;128, 0x0F&#x3D;1111(binary))</p>
<p>&#x2F;&#x2F;Bit 3&#x3D; Auto offset compensation &#x3D; Enabled</p>
<p>&#x2F;* Register #3 LED Current Setting for Proximity Mode</p>
<p>Register address &#x3D; 83h. This register is to set the LED current value for proximity measurement.</p>
<p>The value is adjustable in steps of 10 mA from 0 mA to 200 mA.</p>
<p>This register also contains information about the used device fuse program ID. *&#x2F;</p>
<p>writeVCNLByte(0x83, 15); &#x2F;*</p>
<p>R&#x2F;W bits. IR LED current &#x3D; Value (dec.) x 10 mA.</p>
<p>Valid Range &#x3D; 0 to 20d.</p>
<p>sets IR current in steps of 10mA 0-200mA &#x2F;&#x2F;–&gt; 15 decimal&#x3D; 1111(binary)so current is set to 10x150mA&#x3D; 150mA</p>
<p>*&#x2F;</p>
<p>&#x2F;*</p>
<p>Register #9 Proximity Measurement Signal Frequency</p>
<p>Register address &#x3D; 89h *&#x2F;</p>
<p>writeVCNLByte(0x89, 2); &#x2F;&#x2F; Proximity IR test signal freq, 0-3 - &#x2F;&#x2F;781.25 kHz (DEFAULT)</p>
<p>&#x2F;&#x2F; Register #10 Proximity Modulator Timing Adjustment</p>
<p>&#x2F;&#x2F; Register address &#x3D; 8Ah.</p>
<p>writeVCNLByte(0x8A, 0x81); &#x2F;&#x2F; proximity modulator timing – 81 &#x2F;&#x2F;hex&#x3D;129, recommended by Vishay</p>
<p>}</p>
<p>Now we need to write readProximity() function which looks like:</p>
<p>unsigned int readProximity(){</p>
<p>&#x2F;&#x2F; readProximity() returns a 16-bit value from the VCNL4000’s &#x2F;&#x2F;proximity data registers</p>
<p>&#x2F;&#x2F; Register #0 Command Register</p>
<p>Register address &#x3D; 80h</p>
<p>The register #0 is for starting ambient light or proximity measurements. This register contains 2 flag bits for data ready indication.</p>
<p>*&#x2F;</p>
<p>byte temp &#x3D; readVCNLByte(0x80);</p>
<p>writeVCNLByte(0x80, temp | 0x08); &#x2F;* command the sensor to perform a proximity measure</p>
<p>The command temp | 0x08 is needed because bits 0-2 are N&#x2F;A (we dont need them, they can be equal to 0, so we are setting third bit (bit 3) to 1, it is Prox. od bit -&gt; R&#x2F;W bit. Starts a single on-demand measurement for  <strong>proximity</strong>.</p>
<p>Result is available at the end of conversion for reading in the registers #7 (HB) and #8 (LB).)*&#x2F;</p>
<p>while(!(readVCNLByte(0x80)&amp;0x20)); &#x2F; Wait for the proximity data ready bit to be set</p>
<p>We are setting fifth bit (bit 5) (0x20 hex&#x3D;100000 binary) in register 0x80 to 1, it is Proximity data ready bit, Read only bit. Value &#x3D; 1 when proximity measurement data is available in the result registers. This bit will be reset when one of the corresponding result registers (reg #7, reg #8) is read. *&#x2F;</p>
<p>unsigned int data &#x3D; readVCNLByte(0x87) &lt;&lt; 8; &#x2F;&#x2F;Shift data from &#x2F;&#x2F;register 7 (bits 0:7)</p>
<p>data |&#x3D; readVCNLByte(0x88); &#x2F;&#x2F;read data from register 8</p>
<p>return data;</p>
<p>}</p>
<p>unsigned int readAmbient(){</p>
<p>&#x2F;&#x2F; readAmbient() returns a 16-bit value from the VCNL4000’s ambient light data registers</p>
<p>byte temp &#x3D; readVCNLByte(0x80);</p>
<p>writeVCNLByte(0x80, temp | 0x10); &#x2F;* command the sensor to perform ambient measure</p>
<p>-&gt; 0x10 &#x3D; 10000 binary, set bit 4 from register 0x80 to 1,</p>
<p>als od R&#x2F;W bit. Starts a single on-demand measurement for ambient light. If averaging is enabled, starts a sequence of readings and stores the averaged result. Result is available at the end of conversion for reading in the registers #5 (HB) and #6 (LB).</p>
<p>*&#x2F;</p>
<p>while(!(readVCNLByte(0x80)&amp;0x40)); &#x2F;&#x2F; wait for the als data ready bit to be set als data rdy -&gt; bit 6</p>
<p>unsigned int data &#x3D; readVCNLByte(0x85) &lt;&lt; 8; &#x2F;&#x2F;The same as proximity measure</p>
<p>data |&#x3D; readVCNLByte(0x86);</p>
<p>return data;</p>
<p>}</p>
<p>void writeVCNLByte(byte address, byte data){</p>
<p>&#x2F;&#x2F; writeVCNLByte(address, data) writes a single byte of data to address</p>
<p>Wire.beginTransmission(VCNL4000_ADDRESS);</p>
<p>Wire.write(address);</p>
<p>Wire.write(data);</p>
<p>Wire.endTransmission();</p>
<p>}</p>
<p>byte readVCNLByte(byte address){</p>
<p>&#x2F;&#x2F; readByte(address) reads a single byte of data from address</p>
<p>Wire.beginTransmission(VCNL4000_ADDRESS);</p>
<p>Wire.write(address);</p>
<p>Wire.endTransmission();</p>
<p>Wire.requestFrom(VCNL4000_ADDRESS, 1);</p>
<p>while(!Wire.available());</p>
<p>byte data &#x3D; Wire.read();</p>
<p>return data;</p>
<p>}</p>
<p>You can download arduino sketch <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=https://dl.dropboxusercontent.com/u/765299/vcnl4000.pde&t=NzFiNGY3ZjQwYWMwNzg1NGFlZTFhOWI2YzJkZjU4NGUxOWNlMjhjNCxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">here</a>, and <a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://numato.com/vcnl4000-integrated-proximity-and-ambient-light-sensor&t=OWI4YjUxMDZhYzJiZmNmNWI4M2JkODI3ZDA2ZDZkY2I3MDBiNDc1YixwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">here</a> you can buy the sensor<br>board.</p>
<p><a target="_blank" rel="noopener" href="https://t.umblr.com/redirect?z=http://dlnmh9ip6v2uc.cloudfront.net/datasheets/BreakoutBoards/vcnl4000App.pdf&t=MGZlMTg3Y2E0NmJmNGUxYzk2MDhkZDJhMjJlNzM1ZmQ3ZGNiZDZhOSxwcU5HNTFxSA==&b=t:FD6XX10bZXL2piQlYe7bhw&p=http://sdizdar.tumblr.com/post/82198036431/numato-vcnl4000-integrated-proximity-and-ambient&m=1">Datasheet VCNL4000</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sdizdarevic.github.io/2018/03/07/Numato-VCNL4000-Integrated-Proximity-and-Ambient-Light-Sensor/" data-id="clgwlc734000danbv53bn1ozi" data-title="Numato VCNL4000 - Integrated Proximity and Ambient Light Sensor
" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/03/07/Sparrowboard-1450-Numato-getting-started/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Sparrowboard 1450 Numato getting started
        
      </div>
    </a>
  
  
    <a href="/2018/03/07/FRDM-K64F-project/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">FRDM-K64F project</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/25/hello-world/">Rumi</a>
          </li>
        
          <li>
            <a href="/2018/03/15/Sarajevska-molitva/">Sarajevska molitva</a>
          </li>
        
          <li>
            <a href="/2018/03/09/Setting-STM32-in-Ubuntu/">Setting STM32 in Ubuntu</a>
          </li>
        
          <li>
            <a href="/2018/03/09/Imagination-touts-cheap-Firefox-OS-MIPS-slab-to-Chinese-kitmakers/">Imagination touts cheap Firefox OS MIPS slab to Chinese kitmakers
</a>
          </li>
        
          <li>
            <a href="/2018/03/08/Fourier-series/">Fourier series</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 sdizdar<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>